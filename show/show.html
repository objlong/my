<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>作品展示</title>
	<style type="text/css">
		body, ul, li{
			margin: 0px;
			padding: 0px;
		}
		li{
			list-style-type: none;
		}
		.div1{
			width: 960px;
			margin: 0 auto;
			position: absolute;
			left: 0;
			right: 0;
			bottom: -20px;
			height: 100%;
			overflow: hidden;
			min-width: 960px;
		}
		#oUl{
			width: 100%;
			position: absolute;
			left: 0;
			bottom: 0;
			overflow: hidden;
			transition :transform 1s cubic-bezier(.445,.05,.55,.95);
			-webkit-transition :-webkit-transform 1s cubic-bezier(.445,.05,.55,.95);
		}
		#oUl li{
			width: 127px;
			position: relative;
			float: left;
			margin: 0 5px;
			transition: transform .1s cubic-bezier(.445,.05,.55,.95);
			-webkit-transition: -webkit-transform .1s cubic-bezier(.445,.05,.55,.95);
			will-change: transform;
		}
		#oUl li div{
			width: 100%;
			max-width: 100%;
			height: 540px;
			position: relative;
			background-repeat:  no-repeat;
			cursor: pointer;
			transition: transform .3s cubic-bezier(0,.68,.86,.98);
			-webkit-transition: -webkit-transform .3s cubic-bezier(0,.68,.86,.98);
			will-change: transform;
		}
		#oUl li div p {
			display: none;
		}
		#oUl li:nth-child(1) div{
			-webkit-transform: translate3d( 0px,63%,0px) rotateY(180deg);
			transform: translate3d( 0px,63%,0px) rotateY(180deg);
			background-color: #FF6A65;
		}
		#oUl li:nth-child(2) div{
			-webkit-transform: translate3d( 0px,47%,0px) rotateY(180deg);
			transform: translate3d( 0px,47%,0px) rotateY(180deg);
			background-color: #FF6A65;
		}
		#oUl li:nth-child(3) div{
			-webkit-transform: translate3d( 0px,67%,0px) rotateY(180deg);
			transform: translate3d( 0px,67%,0px) rotateY(180deg);
			background-color: #FF6A65;
		}
		#oUl li:nth-child(4) div{
			-webkit-transform: translate3d( 0px,47%,0px) rotateY(180deg);
			transform: translate3d( 0px,47%,0px) rotateY(180deg);
			background-color: #FF6A65;
		}
		#oUl li:nth-child(5) div{
			-webkit-transform: translate3d( 0px,27%,0px) rotateY(180deg);
			transform: translate3d( 0px,27%,0px) rotateY(180deg);
			background-color: #FF6A65;
		}
		#oUl li:nth-child(6) div{
			-webkit-transform: translate3d( 0px,47%,0px) rotateY(180deg);
			transform: translate3d( 0px,47%,0px) rotateY(180deg);
			background-color: #FF6A65;
		}
		#oUl li:nth-child(7) div{
			-webkit-transform: translate3d( 0px,61%,0px) rotateY(180deg);
			transform: translate3d( 0px,61%,0px) rotateY(180deg);
			background-color: #FF6A65;
		}
		#oUl li.prev{
			transform: translate3d(-13%,0,0);
			-webkit-transform: translate3d(-13%,0,0);
		}
		#oUl li.next{
			transform: translate3d(13%,0,0);
			-webkit-transform: translate3d(13%,0,0);
		}
		#boost li:nth-child(n) div{
			transform:translate3d(0,35%,0) rotateY(180deg)!important;
			-webkit-transform:translate3d(0,35%,0) rotateY(180deg)!important;
		}
		#boost ul li.lager div{
			transform:translate3d(0,25%,0) rotateY(360deg) !important;
			-webkit-transform:translate3d(0,25%,0) rotateY(360deg) !important;

		}
		#boost ul li.lager div p{
			display: block !important;
		}
	</style>
</head>
<body>
	<div class = "div1">
		<ul id="oUl">
			<audio id='audiomedia' src= 'imgs/123.mp3' loop= 'loop' autoplay= 'autoplay'></audio>
			<li>
				<div class="content"><p>作品内容</p></div>
			</li>
			<li>
				<div class="content"><p>作品内容</p></div>
			</li>
			<li>
				<div class="content"><p>作品内容</p></div>
			</li>
			<li>
				<div class="content"><p>作品内容</p></div>
			</li>
			<li>
				<div class="content"><p>作品内容</p></div>
			</li>
			<li>
				<div class="content"><p>作品内容</p></div>
			</li>
			<li>
				<div class="content"><p>作品内容</p></div>
			</li>
		</ul>
	</div>
</body>
</html>
<script type="text/javascript" src="js/jquery.js"></script>
<script type="text/javascript">
	var W = $('.div1').outerWidth();
	var L = $('.div1').offset().left;
	//动画效果；
	var timer = null ;
	var l = $('#oUl').outerWidth()/7 * 5;
	function out () {
		if (onoff) {
			cancelAnimationFrame(timer);
			$('#oUl div').attr("style" , "")
		}
		onoff = false;
	}
	function move (ev) {
		onoff = true;
		if (onoff) {
			var e = ev || event ;
			var X = e.pageX;
			cancelAnimationFrame(timer);
			timer = requestAnimationFrame(function  () {
				for (var i = 0; i < $('#oUl div').length; i++) {
					var middle = $('#oUl div').eq(i).offset().left + $('#oUl li').outerWidth()/2;
					var distance = Math.abs(middle - X);
					if (distance > l) {
						distance = l ;
					}
					var scale = Math.abs(distance/l) * 60;
					$('#oUl div').eq(i).css({
						"-webkit-transform" : "translate3d(0, " + scale + "%, 0) rotateY(180deg)" , 
						"transform" : "translate3d(0, " + scale + "%, 0) rotateY(180deg)"
					})
				}
			})
		}
		console.log(onoff)
	}
	// var oUl = document.getElementById('oUl');
	// oUl.onmousemove = move;
	var Mousemove = $('#oUl').mousemove(move);
	$('#oUl').mouseout(out);
	// console.log($('#oUl').mouseover() = null)
	//放大翻转效果
	var onoff = false ;
	$('#oUl').click(function  (ev) {
		cancelAnimationFrame(timer);
		var e = ev || event ; 
		if (onoff) {
			var target = $(e.target) ; 
			if (e.target.nodeName == 'DIV') {
				$('.div1').attr("id" , "boost")
				var middletarget = target.parent().offset().left + target.parent().outerWidth()/2;
				middletarget = W/2 + L - middletarget ;
				$('#oUl').css({
					"-webkit-transform" : "translate3d(" + ( 3 * middletarget ) + "px, 0, 0) scale(3)" ,
					"transform" : "translate3d(" + ( 3 * middletarget ) + "px, 0, 0) scale(3)"
				})
				for (var i = 0; i < $('#oUl div').length; i++) {
					$('#oUl div').eq(i).css({
						"-webkit-transition" : "display -webkit-transform .5s cubic-bezier(0.445, 0.05, 0.55, 0.95)",
						"transition" : "display transform .5s cubic-bezier(0.445, 0.05, 0.55, 0.95)"
					})
					if (i < target.index('#oUl li div')) {
						$('#oUl li').eq(i).addClass('prev');
					}else if (i > target.index('#oUl li div')) {
						$('#oUl li').eq(i).addClass('next');
					}
				}
				target.parent().addClass('lager');
			}	
			// oUl.onmousemove = null;
			Mousemove.unbind('mousemove');
			onoff = false ; 
		}else{
			$('.div1').removeAttr('id');
			$('#oUl').removeAttr('style');
			$('#oUl li').removeAttr('class');
			setTimeout(function  () {
				onoff = true ; 
			},900)
			// oUl.onmousemove = move;
			Mousemove = $('#oUl').mousemove(move);
		}
	})

	//音乐部分
	var media = document.getElementById('audiomedia');
	var audioContext, analyser, sound, arr,num, k, m, n;
	media.addEventListener('canplay',loading)
	//加载音频数据
	function loading() {
		audioContext = audioContext || new AudioContext();//新建音频数据对象
		analyser = (analyser || audioContext.createAnalyser());//音频解码器
		//从 `<audio>` 元素创建一个MediaElementAudioSourceNode(媒体元素音频源结点)
		//直接操作HTMLMediaElement, 像play()和pause()的方法均可调用.
		sound = audioContext.createMediaElementSource(media);
		//将sound与解码器和音频对象相连
		sound.connect(analyser);
		sound.connect(audioContext.destination);
		media.play();		
		update();
	}
	//音频数据解析
	function update() {
		//二进制音频数据解析
		arr = new Uint8Array(analyser.frequencyBinCount);
		analyser.getByteFrequencyData(arr);
		Active(arr);
		if (!media.paused) {
			requestAnimationFrame(update);
		}
	}
	//动画函数
	var adiv = document.getElementsByClassName('content');
	function Active(arr){
		if (!onoff) {
	    	var step = Math.round(arr.length / 8); 
	    	for( var i = 0; i < 7; i++ ){
	    		num = arr[i * 10];
	    		k = (num) / $('.content').eq(i).height() * 100;
				m = 100 - k;
				n = (m-30)>0?(m-30):0;
				// console.log(step,num,step,k,m,n)
	    		$('.content').eq(i).css({"-webkit-transform" : "translate3d(0," + n + "%,0) rotateY(180deg)",
	    								"transform" : "translate3d(0,"+ n +"%,0) rotateY(180deg)"})	
	    	}
	    }
	}
//requsetAnimationFrame与cancelRequestAnimationFrame兼容性；
window.requestAnimationFrame = (function () {
    var originalRequestAnimationFrame = undefined,
        wrapper = undefined,
        callback = undefined,
        geckoVersion = null,
        userAgent = navigator.userAgent,
        index = 0,
        self = this;

    wrapper = function (time) {
        time = performance.now();
        self.callback(time);
    };

    /*!
     bug!
     below code:
     when invoke b after 1s, will only invoke b, not invoke a!

     function a(time){
     console.log("a", time);
     webkitRequestAnimationFrame(a);
     }

     function b(time){
     console.log("b", time);
     webkitRequestAnimationFrame(b);
     }

     a();

     setTimeout(b, 1000);



     so use requestAnimationFrame priority!
     */
    if(window.requestAnimationFrame) {
        return requestAnimationFrame;
    }


    // Workaround for Chrome 10 bug where Chrome
    // does not pass the time to the animation function

    if (window.webkitRequestAnimationFrame) {
        // Define the wrapper

        // Make the switch

        originalRequestAnimationFrame = window.webkitRequestAnimationFrame;

        window.webkitRequestAnimationFrame = function (callback, element) {
            self.callback = callback;

            // Browser calls the wrapper and wrapper calls the callback

            return originalRequestAnimationFrame(wrapper, element);
        }
    }

    //修改time参数
    if (window.msRequestAnimationFrame) {
        originalRequestAnimationFrame = window.msRequestAnimationFrame;

        window.msRequestAnimationFrame = function (callback) {
            self.callback = callback;

            return originalRequestAnimationFrame(wrapper);
        }
    }

    // Workaround for Gecko 2.0, which has a bug in
    // mozRequestAnimationFrame() that restricts animations
    // to 30-40 fps.

    if (window.mozRequestAnimationFrame) {
        // Check the Gecko version. Gecko is used by browsers
        // other than Firefox. Gecko 2.0 corresponds to
        // Firefox 4.0.

        index = userAgent.indexOf('rv:');

        if (userAgent.indexOf('Gecko') != -1) {
            geckoVersion = userAgent.substr(index + 3, 3);

            if (geckoVersion === '2.0') {
                // Forces the return statement to fall through
                // to the setTimeout() function.

                window.mozRequestAnimationFrame = undefined;
            }
        }
    }

    return window.webkitRequestAnimationFrame ||
        window.mozRequestAnimationFrame ||
        window.oRequestAnimationFrame ||
        window.msRequestAnimationFrame ||

        function (callback, element) {
            var start,
                finish;

            window.setTimeout(function () {
                start = performance.now();
                callback(start);
                finish = performance.now();

                self.timeout = 1000 / 60 - (finish - start);

            }, self.timeout);
        };
})();


    window.cancelRequestAnimationFrame = window.cancelRequestAnimationFrame
        || window.webkitCancelAnimationFrame
        || window.webkitCancelRequestAnimationFrame
        || window.mozCancelRequestAnimationFrame
        || window.oCancelRequestAnimationFrame
        || window.msCancelRequestAnimationFrame
        || clearTimeout;
</script>